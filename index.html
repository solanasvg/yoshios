<html><head><base href="." /><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>YoshiOS</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', sans-serif;
}

body {
    background: linear-gradient(135deg, #0078d7, #005a9e);
    height: 100vh;
    overflow: hidden;
}

#desktop {
    height: calc(100vh - 40px);
    position: relative;
    padding: 10px;
}

.icon {
    width: 80px;  
    height: 100px; 
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 10px;
    cursor: pointer;
    color: white;
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 10px;
    backdrop-filter: blur(5px);
    transition: transform 0.2s, background 0.2s;
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.icon svg {
    width: 48px;  
    height: 48px; 
    margin-bottom: 5px; 
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.icon span {
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    font-size: 0.8em; 
    margin-top: 5px; 
    width: 100%;
    word-wrap: break-word;
    line-height: 1.1; 
}

#taskbar {
    height: 40px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.5);
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
    position: fixed;
    bottom: 0;
    width: 100%;
    display: flex;
    align-items: center;
    padding: 0 10px;
}

#start-btn {
    padding: 6px 16px;
    background: linear-gradient(to bottom, #32a5f2, #1a5fb4);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 5px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
}

#start-btn img {
    width: 16px;
    height: 16px;
    object-fit: contain;
    margin-right: 5px;
}

#start-btn:hover {
    background: linear-gradient(to bottom, #42b5ff, #2a6fc4);
}

#start-btn:active {
    transform: translateY(1px);
}

#start-menu {
    position: fixed;
    bottom: 40px;
    left: 0;
    width: 250px; 
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.7);
    border-radius: 8px 8px 0 0;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
    display: none;
    padding: 8px 4px;
    z-index: 1000;
}

.start-item {
    padding: 10px 15px;
    border-radius: 6px;
    margin: 2px 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #333;
    transition: all 0.2s ease;
}

.start-item:hover {
    background: linear-gradient(to bottom, #32a5f2, #1a5fb4);
    color: white;
}

.start-item svg {
    display: inline-block;
    vertical-align: middle;
}

#fullscreen-toggle {
    display: flex;
    align-items: center;
}

.window {
    position: absolute;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.7);
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    min-width: 200px;
    min-height: 150px;
    display: flex;
    flex-direction: column;
    resize: both;
    overflow: hidden; /* Change from auto to hidden */
    transition: box-shadow 0.3s ease;
}

.window-header {
    background: linear-gradient(to bottom, #2b91e2, #1a5fb4);
    border-radius: 8px 8px 0 0;
    padding: 8px;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: move;
    position: sticky;
    top: 0;
    z-index: 1;
}

/* Add new styles for the close button */
.close-btn {
    width: 24px;
    height: 24px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    background: linear-gradient(to bottom, #f85f5f, #d64242);
    color: white;
    border-radius: 3px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 8px;
    text-shadow: 0 1px 0 rgba(0,0,0,0.3);
    box-shadow: inset 0 1px rgba(255,255,255,0.3), 
                0 1px 2px rgba(0,0,0,0.2);
    transition: background 0.2s;
    padding: 0;
    position: relative;
    overflow: hidden;
}

/* Add hover effect */
.close-btn:hover {
    background: linear-gradient(to bottom, #ff7373, #e85454);
}

/* Add active/pressed effect */
.close-btn:active {
    background: linear-gradient(to bottom, #d64242, #c63939);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
}

/* Add the glossy overlay effect */
.close-btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(to bottom,
        rgba(255,255,255,0.4) 0%,
        rgba(255,255,255,0.2) 50%,
        rgba(255,255,255,0) 100%);
    border-radius: 2px 2px 0 0;
}

.window-content {
    padding: 10px;
    flex-grow: 1;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 0 0 8px 8px;
    overflow: auto; /* Allow content to scroll */
    height: calc(100% - 35px); /* Subtract header height */
}

#clock {
    margin-left: auto;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    backdrop-filter: blur(5px);
    color: black; /* Change from white to black */
}

#calculator {
    width: 200px;
}

.calc-display {
    width: 100%;
    padding: 5px;
    margin-bottom: 10px;
    text-align: right;
    border: 2px inset #ffffff;
}

.calc-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
}

.calc-btn {
    padding: 5px;
    background: linear-gradient(to bottom, #f8f8f8, #e1e1e1);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    cursor: pointer;
}

.calc-btn:hover {
    background: linear-gradient(to bottom, #ffffff, #f0f0f0);
}

#notepad-content {
    width: 100%;
    height: 100%;
    resize: none;
    border: none;
    outline: none;
    padding: 5px;
}

.paint-toolbar {
    margin-bottom: 10px;
    display: flex;
    gap: 10px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 6px;
    padding: 8px;
}

.explorer-toolbar {
    padding: 5px;
    display: flex;
    gap: 5px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 6px;
}

.explorer-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 80px;
    text-align: center;
    cursor: pointer;
    padding: 5px;
}

.explorer-item:hover {
    background: rgba(0, 0, 0, 0.1);
}

#path-input {
    flex-grow: 1;
    padding: 2px 5px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    background: rgba(255, 255, 255, 0.95);
}

/* Add this to the existing CSS section */
#boot-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #1e2832, #2a3b4a);
    z-index: 99999;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s ease-in-out;
}

.boot-logo {
    width: 200px;
    height: 200px;
    margin-bottom: 30px;
    animation: pulse 2s infinite; /* Changed from original duration */
    filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
}

.boot-progress {
    width: 300px;
    height: 4px;
    background: rgba(255,255,255,0.1);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
}

.boot-progress::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #32a5f2, #1a5fb4);
    animation: progress 3s ease-out forwards;
    box-shadow: 0 0 10px rgba(26, 95, 180, 0.5);
}

.boot-text {
    color: white;
    margin-top: 20px;
    font-size: 18px;
    text-shadow: 0 0 10px rgba(255,255,255,0.3);
    opacity: 0.8;
}

@keyframes pulse {
    0% {
        transform: scale(1);
        filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
    }
    50% {
        transform: scale(1.05);
        filter: drop-shadow(0 0 30px rgba(255,255,255,0.5));
    }
    100% {
        transform: scale(1);
        filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
    }
}

@keyframes progress {
    0% { width: 0%; }
    50% { width: 60%; } /* Slowed down progress */
    70% { width: 75%; }
    85% { width: 85%; }
    95% { width: 95%; }
    100% { width: 100%; }
}

/* Add welcome window styles */
.welcome-window {
    background: rgba(255, 255, 255, 0.98);
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
}

.welcome-content {
    padding: 30px;
    text-align: center;
}

.welcome-header {
    font-size: 24px;
    color: #333;
    margin-bottom: 20px;
}

.welcome-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin: 30px 0;
}

.welcome-item {
    padding: 15px;
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.2s;
}

.welcome-item:hover {
    transform: translateY(-2px);
}

.welcome-footer {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #eee;
}
</style>
</head>
<body>
<div id="boot-screen">
    <img src="https://u57l16yf3qe9snknuxr0.c.websim.ai/s-l1200__1_-removebg-preview.png" alt="YoshiOS Boot Logo" class="boot-logo">
    <div class="boot-progress"></div>
    <div class="boot-text">Starting YoshiOS...</div>
    <div style="color: white; position: absolute; bottom: 20px; font-size: 12px; opacity: 0.7; width: 100%; text-align: center;">
        YoshiOS Â© 2024 YoshiTech Corporation. All rights reserved.
    </div>
</div>
<div id="desktop">
    <!-- Desktop icons -->
</div>

<div id="taskbar">
    <button id="start-btn">
        <img src="https://u57l16yf3qe9snknuxr0.c.websim.ai/s-l1200__1_-removebg-preview.png" alt="Yoshi Start">
        YoshiOS
    </button>
    <div id="clock"></div>
</div>

<div id="start-menu">
    <div class="start-item" data-app="calculator">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="calcGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#6ab3ff;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2d8aff;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#calcGradStart)"/>
            <rect x="4" y="4" width="8" height="8" fill="red"/>
            <rect x="12" y="4" width="8" height="8" fill="green"/>
            <rect x="4" y="12" width="8" height="8" fill="blue"/>
            <rect x="12" y="12" width="8" height="8" fill="yellow"/>
        </svg>
        Calculator
    </div>
    <div class="start-item" data-app="browser">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="browserGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#87ffce;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#40c4ff;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#browserGradStart)"/>
            <circle cx="12" cy="12" r="5" fill="none" stroke="#fff" stroke-width="2"/>
            <path d="M12,7 L12,17 M7,12 L17,12" stroke="#fff" stroke-width="2"/>
        </svg>
        Web Browser
    </div>
    <div class="start-item" data-app="school">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="schoolGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#9575cd;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#5e35b1;stop-opacity:1" />
                </linearGradient>
            </defs>
            <path d="M12,4 L4,8 L12,12 L20,8 L12,4" fill="#fff"/>
            <path d="M7,10 L7,15 L12,18 L17,15 L17,10" fill="#fff" opacity="0.6"/>
        </svg>
        Learning Center
    </div>
    <div class="start-item" data-app="docit">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="docGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#81d4fa;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#29b6f6;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#docGradStart)"/>
            <rect x="6" y="6" width="12" height="2" fill="#fff" opacity="0.9"/>
            <rect x="6" y="10" width="12" height="1" fill="#fff" opacity="0.7"/>
            <rect x="6" y="13" width="12" height="1" fill="#fff" opacity="0.7"/>
            <rect x="6" y="16" width="8" height="1" fill="#fff" opacity="0.7"/>
        </svg>
        DocIt
    </div>
    <div class="start-item" id="fullscreen-toggle">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="fullscreenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#a1c9f7;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#55a3f7;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#fullscreenGrad)"/>
            <path d="M3 3h6v2H5v4H3V3z M21 3h-6v2h4v4h2V3z M21 21h-6v-2h4v-4h2v6z M3 21h6v-2H5v-4H3v6z" fill="#fff"/>
        </svg>
        Toggle Fullscreen
    </div>
    <div class="start-item" id="shutdown">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="shutdownGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ff8787;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ff4040;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#shutdownGrad)"/>
            <path d="M12 4v8M8 8.5a5 5 0 1 0 8 0" stroke="#fff" stroke-width="2" fill="none"/>
        </svg>
        Shutdown
    </div>
    <div style="padding: 10px; font-size: 11px; color: #666; text-align: center; border-top: 1px solid #eee; margin-top: 10px;">
        YoshiOS Â© 2024 YoshiTech Corporation
    </div>
</div>

<script>
// Boot screen handler
document.addEventListener('DOMContentLoaded', () => {
    const bootScreen = document.getElementById('boot-screen');
    
    // Hide boot screen after animation completes
    setTimeout(() => {
        bootScreen.style.opacity = '0';
        setTimeout(() => {
            bootScreen.style.display = 'none';
            welcome.createWelcome(); // Show welcome screen after boot
        }, 500);
    }, 3500); // Changed from 3000 to 3500 to match animation duration
});

// Start Menu
const startBtn = document.getElementById('start-btn');
const startMenu = document.getElementById('start-menu');

// Toggle start menu when clicking start button
startBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent document click from immediately closing
    startMenu.style.display = startMenu.style.display === 'none' ? 'block' : 'none';
});

// Close start menu when clicking outside
document.addEventListener('click', (e) => {
    if (!startMenu.contains(e.target) && !startBtn.contains(e.target)) {
        startMenu.style.display = 'none';
    }
});

// Handle start menu item clicks
document.querySelectorAll('.start-item').forEach(item => {
    item.addEventListener('click', () => {
        const app = item.dataset.app;
        startMenu.style.display = 'none';
        
        switch(app) {
            case 'calculator':
                calculator.createCalculator();
                break;
            case 'notepad':
                notepad.createNotepad();
                break;
            case 'paint':
                paint.createPaint();
                break;
            case 'explorer':
                fileExplorer.createExplorer();
                break;
            case 'browser':
                webBrowser.createBrowser();
                break;
            case 'mediaplayer':
                mediaPlayer.createMediaPlayer();
                break;
            case 'calendar':
                calendar.createCalendar();
                break;
            case 'email':
                email.createEmail();
                break;
            case 'weather':
                weather.createWeather();
                break;
            case 'school':
                school.createSchool();
                break;
            case 'slides':
                slides.createSlides();
                break;
            case 'docit':
                docit.createDocIt();
                break;
        }
    });
});

// Handle fullscreen toggle
document.getElementById('fullscreen-toggle').addEventListener('click', () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
    startMenu.style.display = 'none';
});

// Add Welcome class
class Welcome {
    createWelcome() {
        const content = `
            <div class="welcome-content">
                <div style="background: #ffe1e1; color: #d32f2f; padding: 10px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ffcdd2; text-align: center;">
                    <strong>â ï¸ WARNING:</strong> Do not pointlessly remix this OS!
                </div>
                <div class="welcome-header">
                    <h2>Welcome to YoshiOS</h2>
                    <p>Let's help you get started with your new operating system!</p>
                </div>
                <div class="welcome-grid">
                    <div class="welcome-item" onclick="school.createSchool()">
                        <h3>Start Learning</h3>
                        <p>Access educational resources</p>
                    </div>
                    <div class="welcome-item" onclick="docit.createDocIt()">
                        <h3>Create Documents</h3>
                        <p>Write and edit documents</p>
                    </div>
                    <div class="welcome-item" onclick="webBrowser.createBrowser()">
                        <h3>Browse Web</h3>
                        <p>Explore the internet</p>
                    </div>
                    <div class="welcome-item" onclick="slides.createSlides()">
                        <h3>Make Presentations</h3>
                        <p>Create stunning slideshows</p>
                    </div>
                    <div class="welcome-item" onclick="paint.createPaint()">
                        <h3>Express Creativity</h3>
                        <p>Draw and paint</p>
                    </div>
                    <div class="welcome-item" onclick="calculator.createCalculator()">
                        <h3>Calculate</h3>
                        <p>Perform calculations</p>
                    </div>
                </div>
                <div class="welcome-footer">
                    <button onclick="this.closest('.window').remove()" style="padding: 10px 20px;">Get Started</button>
                    <div style="margin-top: 15px; font-size: 12px; color: #666;">
                        YoshiOS Â© 2024 YoshiTech Corporation. All rights reserved.
                    </div>
                </div>
            </div>
        `;
        
        const window = windowManager.createWindow('Welcome to YoshiOS', content, 700, 500);
        window.classList.add('welcome-window');
    }
}

// Initialize welcome
const welcome = new Welcome();

// Modify boot screen text
document.querySelector('.boot-text').textContent = 'Starting YoshiOS...';

// Update Start button text
document.querySelector('#start-btn').innerHTML = `
    <img src="/s-l1200__1_-removebg-preview.png" alt="Yoshi Start">
    YoshiOS
`;

// Window Management System
class WindowManager {
    constructor() {
        this.windows = new Set();
        this.activeWindow = null;
        this.zIndex = 1000;
    }

    createWindow(title, content, width = 300, height = 200) {
        const window = document.createElement('div');
        window.className = 'window';
        window.style.width = width + 'px';
        window.style.height = height + 'px';
        window.style.zIndex = this.zIndex++;

        window.innerHTML = `
            <div class="window-header">
                <span>${title}</span>
                <button class="close-btn">Ã</button>
            </div>
            <div class="window-content">${content}</div>
        `;

        document.getElementById('desktop').appendChild(window);
        this.windows.add(window);
        this.makeWindowDraggable(window);
        this.setActiveWindow(window);

        window.querySelector('.close-btn').addEventListener('click', () => {
            this.closeWindow(window);
        });

        window.addEventListener('mousedown', () => {
            this.setActiveWindow(window);
        });

        return window;
    }

    closeWindow(window) {
        window.remove();
        this.windows.delete(window);
    }

    setActiveWindow(window) {
        this.activeWindow = window;
        this.windows.forEach(w => {
            w.style.zIndex = w === window ? this.zIndex++ : w.style.zIndex;
        });
    }

    makeWindowDraggable(window) {
        const header = window.querySelector('.window-header');
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;

        header.addEventListener('mousedown', (e) => {
            isDragging = true;
            initialX = e.clientX - window.offsetLeft;
            initialY = e.clientY - window.offsetTop;
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            e.preventDefault();
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;

            window.style.left = currentX + 'px';
            window.style.top = currentY + 'px';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
    }
}

// Calculator App
class Calculator {
    constructor() {
        this.currentValue = '';
        this.previousValue = '';
        this.operation = null;
    }

    createCalculator() {
        const content = `
            <input type="text" class="calc-display" readonly value="0">
            <div class="calc-buttons">
                <button class="calc-btn" data-type="clear">C</button>
                <button class="calc-btn" data-type="operation">/</button>
                <button class="calc-btn" data-type="operation">*</button>
                <button class="calc-btn" data-type="operation">-</button>
                <button class="calc-btn" data-type="number">7</button>
                <button class="calc-btn" data-type="number">8</button>
                <button class="calc-btn" data-type="number">9</button>
                <button class="calc-btn" data-type="operation">+</button>
                <button class="calc-btn" data-type="number">4</button>
                <button class="calc-btn" data-type="number">5</button>
                <button class="calc-btn" data-type="number">6</button>
                <button class="calc-btn" data-type="equals">=</button>
                <button class="calc-btn" data-type="number">1</button>
                <button class="calc-btn" data-type="number">2</button>
                <button class="calc-btn" data-type="number">3</button>
                <button class="calc-btn" data-type="number">0</button>
                <button class="calc-btn" data-type="decimal">.</button>
            </div>
        `;

        const window = windowManager.createWindow('Calculator', content, 200, 300);
        this.display = window.querySelector('.calc-display');
        this.attachEventListeners(window);
    }

    attachEventListeners(window) {
        window.querySelectorAll('.calc-btn').forEach(button => {
            button.addEventListener('click', () => {
                const type = button.dataset.type;
                const value = button.textContent;

                switch(type) {
                    case 'number':
                        this.appendNumber(value);
                        break;
                    case 'operation':
                        this.setOperation(value);
                        break;
                    case 'equals':
                        this.calculate();
                        break;
                    case 'clear':
                        this.clear();
                        break;
                    case 'decimal':
                        this.appendDecimal();
                        break;
                }
                this.updateDisplay();
            });
        });
    }

    appendNumber(number) {
        if (this.currentValue === '0') this.currentValue = '';
        this.currentValue += number;
    }

    setOperation(op) {
        if (this.currentValue === '') return;
        if (this.previousValue !== '') {
            this.calculate();
        }
        this.operation = op;
        this.previousValue = this.currentValue;
        this.currentValue = '';
    }

    calculate() {
        let computation;
        const prev = parseFloat(this.previousValue);
        const current = parseFloat(this.currentValue);
        if (isNaN(prev) || isNaN(current)) return;

        switch (this.operation) {
            case '+':
                computation = prev + current;
                break;
            case '-':
                computation = prev - current;
                break;
            case '*':
                computation = prev * current;
                break;
            case '/':
                computation = prev / current;
                break;
            default:
                return;
        }

        this.currentValue = computation.toString();
        this.operation = undefined;
        this.previousValue = '';
    }

    clear() {
        this.currentValue = '0';
        this.previousValue = '';
        this.operation = null;
    }

    appendDecimal() {
        if (!this.currentValue.includes('.')) {
            this.currentValue += '.';
        }
    }

    updateDisplay() {
        this.display.value = this.currentValue || '0';
    }
}

// Notepad App
class Notepad {
    createNotepad() {
        const content = '<textarea id="notepad-content"></textarea>';
        windowManager.createWindow('Notepad', content, 400, 300);
    }
}

// Paint App
class Paint {
    createPaint() {
        const content = `
            <div class="paint-toolbar">
                <input type="color" id="color-picker" value="#000000">
                <select id="brush-size">
                    <option value="1">1px</option>
                    <option value="3">3px</option>
                    <option value="5" selected>5px</option>
                    <option value="10">10px</option>
                </select>
                <button id="clear-canvas">Clear</button>
            </div>
            <canvas id="paint-canvas" style="border: 1px solid #000; background: white;"></canvas>
        `;
        const window = windowManager.createWindow('Paint', content, 600, 400);
        this.initializeCanvas(window);
    }

    initializeCanvas(window) {
        const canvas = window.querySelector('#paint-canvas');
        const ctx = canvas.getContext('2d');
        const content = window.querySelector('.window-content');
        
        canvas.width = content.offsetWidth - 20;
        canvas.height = content.offsetHeight - 50;
        
        let painting = false;
        
        const startPosition = (e) => {
            painting = true;
            draw(e);
        };
        
        const finishedPosition = () => {
            painting = false;
            ctx.beginPath();
        };
        
        const draw = (e) => {
            if(!painting) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.lineWidth = document.querySelector('#brush-size').value;
            ctx.lineCap = 'round';
            ctx.strokeStyle = document.querySelector('#color-picker').value;
            
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        };
        
        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', finishedPosition);
        canvas.addEventListener('mousemove', draw);
        
        window.querySelector('#clear-canvas').addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    }
}

// File Explorer App
class FileExplorer {
    constructor() {
        this.currentPath = 'C:/';
        this.fileSystem = {
            'C:/': {
                'Documents': {
                    'Yoshi Research.txt': {},
                    'Super Mario Notes.txt': {},
                    'Island Maps.pdf': {},
                    'Egg Throwing Guide.doc': {},
                    'Shopping List.txt': {},
                    'Todo List.doc': {},
                    'Project Plan.pdf': {},
                    'Meeting Notes.txt': {}
                },
                'Pictures': {
                    'Yoshi Island.png': {},
                    'Baby Mario and Yoshi.jpg': {},
                    'Green Yoshi.png': {},
                    'Blue Yoshi.jpg': {},
                    'Vacation Photos.jpg': {},
                    'Family Picnic.png': {},
                    'Birthday Party.jpg': {},
                    'Summer Trip.png': {}
                },
                'Music': {},
                'Downloads': {}
            }
        };
    }

    createExplorer() {
        const content = `
            <div class="explorer-toolbar">
                <button id="back-btn">â</button>
                <input type="text" id="path-input" value="C:/" readonly>
            </div>
            <div class="explorer-content" style="display: flex; flex-wrap: wrap; gap: 10px; padding: 10px;"></div>
            <div style="position: absolute; bottom: 5px; left: 0; width: 100%; text-align: center; font-size: 11px; color: #666;">
                YoshiTech File Explorer Â© 2024
            </div>
        `;
        const window = windowManager.createWindow('File Explorer', content, 500, 400);
        this.renderFiles(window);
        
        // Add back button functionality
        window.querySelector('#back-btn').addEventListener('click', () => {
            if (this.currentPath !== 'C:/') {
                this.currentPath = this.currentPath.split('/').slice(0, -2).join('/') + '/';
                window.querySelector('#path-input').value = this.currentPath;
                this.renderFiles(window);
            }
        });
    }

    renderFiles(window) {
        const content = window.querySelector('.explorer-content');
        content.innerHTML = '';
        
        // Get the current directory contents
        let currentLevel = this.fileSystem['C:/'];
        const pathParts = this.currentPath.split('/').filter(Boolean);
        
        // Remove 'C:' from pathParts if it exists
        if (pathParts[0] === 'C:') {
            pathParts.shift();
        }
        
        // Navigate to current directory
        for (const part of pathParts) {
            if (currentLevel && currentLevel[part]) {
                currentLevel = currentLevel[part];
            } else {
                // If path doesn't exist, reset to root
                currentLevel = this.fileSystem['C:/'];
                this.currentPath = 'C:/';
                break;
            }
        }

        // Update path input
        window.querySelector('#path-input').value = this.currentPath;
        
        // Render directory contents
        if (currentLevel) {
            Object.keys(currentLevel).forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'explorer-item';
                
                // Check if item is a file or folder based on file extension
                const isFile = item.includes('.');
                const fileExtension = isFile ? item.split('.').pop().toLowerCase() : '';
                
                let iconSvg;
                if (isFile) {
                    // File icon based on extension
                    switch(fileExtension) {
                        case 'txt':
                        case 'doc':
                        case 'pdf':
                            iconSvg = `<svg viewBox="0 0 24 24" width="40" height="40">
                                <defs>
                                    <linearGradient id="fileGrad${item}" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ffcf87;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ffa726;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M14,2 L20,8 L20,20 L4,20 L4,2 Z" fill="url(#fileGrad${item})"/>
                                <path d="M14,2 L14,8 L20,8 Z" fill="#fff" opacity="0.5"/>
                                <text x="12" y="16" text-anchor="middle" fill="#fff" style="font-size: 4px;">${fileExtension.toUpperCase()}</text>
                            </svg>`;
                            break;
                        case 'jpg':
                        case 'png':
                            iconSvg = `<svg viewBox="0 0 24 24" width="40" height="40">
                                <defs>
                                    <linearGradient id="imgGrad${item}" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ff87b3;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#ff4081;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M4,2 L20,2 L20,20 L4,20 Z" fill="url(#imgGrad${item})"/>
                                <circle cx="8" cy="8" r="2" fill="#fff"/>
                                <path d="M4,20 L20,20 L15,12 L11,16 L8,14 L4,18 Z" fill="#fff" opacity="0.5"/>
                            </svg>`;
                            break;
                    }
                } else {
                    // Folder icon
                    iconSvg = `<svg viewBox="0 0 24 24" width="40" height="40">
                        <defs>
                            <linearGradient id="folderGrad${item}" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#90caf9;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#42a5f5;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <path d="M2,6 L22,6 L22,20 L2,20 Z" fill="url(#folderGrad${item})"/>
                        <path d="M2,6 L10,6 L12,4 L22,4 L22,6" fill="url(#folderGrad${item})"/>
                        <rect x="2" y="6" width="20" height="7" fill="url(#gloss)" opacity="0.3"/>
                    </svg>`;
                }
                
                itemEl.innerHTML = `
                    ${iconSvg}
                    <div>${item}</div>
                `;
                
                // Add click handler only for folders
                if (!isFile) {
                    itemEl.addEventListener('click', () => {
                        this.currentPath += item + '/';
                        window.querySelector('#path-input').value = this.currentPath;
                        this.renderFiles(window);
                    });
                }
                
                content.appendChild(itemEl);
            });
        }
    }
}

// Web Browser App
class WebBrowser {
    createBrowser() {
        const content = `
            <div class="browser-toolbar" style="display: flex; gap: 5px; margin-bottom: 5px; padding: 5px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-radius: 6px;">
                <button id="google-btn" style="padding: 5px 10px;">Google</button>
                <button id="drew-video-btn" style="padding: 5px 10px;">Drew's Video</button>
            </div>
            <div id="browser-content" style="width: 100%; height: calc(100% - 35px); border: none;">
                <div id="google-page" style="display: none; padding: 20px; height: 100%; background: white; overflow-y: auto;">
                    <div style="text-align: center; margin: 20px 0;">
                        <svg viewBox="0 0 272 92" width="272" height="92">
                            <path d="M115.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18C71.25 34.32 81.24 25 93.5 25s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44S80.99 39.2 80.99 47.18c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z" fill="#EA4335"/>
                            <path d="M163.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18c0-12.85 9.99-22.18 22.25-22.18s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44s-12.51 5.71-12.51 13.44c0 7.73 5.79 13.36 12.51 13.36 6.63 0 11.84-5.63 11.84-13.36z" fill="#FBBC05"/>
                            <path d="M209.75 26.34v39.82c0 16.38-9.66 23.07-21.08 23.07-10.75 0-17.22-7.19-19.66-13.07l8.48-3.53c1.51 3.61 5.21 7.87 11.17 7.87 7.31 0 11.84-4.51 11.84-13v-3.19h-.34c-2.18 2.69-6.38 5.04-11.68 5.04-11.09 0-21.25-9.66-21.25-22.09 0-12.52 10.16-22.26 21.25-22.26 5.29 0 9.49 2.35 11.68 4.96h.34v-3.61h9.25zm-8.56 20.92c0-7.81-5.21-13.52-11.84-13.52-6.72 0-12.35 5.71-12.35 13.52 0 7.73 5.63 13.36 12.35 13.36 6.63 0 11.84-5.63 11.84-13.36z" fill="#4285F4"/>
                            <path d="M225 3v65h-9.5V3h9.5z" fill="#34A853"/>
                            <path d="M262.02 54.48l7.56 5.04c-2.44 3.61-8.32 9.83-18.48 9.83-12.6 0-22.01-9.74-22.01-22.18 0-13.19 9.49-22.18 20.92-22.18 11.51 0 17.14 9.16 18.98 14.11l1.01 2.52-29.65 12.28c2.27 4.45 5.8 6.72 10.75 6.72 4.96 0 8.4-2.44 10.92-6.14zm-23.27-7.98l19.82-8.23c-1.09-2.77-4.37-4.7-8.23-4.7-4.95 0-11.84 4.37-11.59 12.93z" fill="#EA4335"/>
                            <path d="M35.29 41.41V32H67c.31 1.64.47 3.58.47 5.68 0 7.06-1.93 15.79-8.15 22.01-6.05 6.3-13.78 9.66-24.02 9.66C16.32 69.35.36 53.89.36 34.91.36 15.93 16.32.47 35.3.47c10.5 0 17.98 4.12 23.6 9.49l-6.64 6.64c-4.03-3.78-9.49-6.72-16.97-6.72-13.86 0-24.7 11.17-24.7 25.03 0 13.86 10.84 25.03 24.7 25.03 8.99 0 14.11-3.61 17.39-6.89 2.66-2.66 4.41-6.46 5.1-11.65l-22.49.01z" fill="#4285F4"/>
                        </svg>
                    </div>
                    <div style="text-align: center; margin: 20px auto; max-width: 600px;">
                        <input type="text" id="google-search" style="width: 100%; padding: 10px; border: 1px solid #dfe1e5; border-radius: 24px; font-size: 16px; outline: none;" placeholder="Search Google">
                    </div>
                    <div id="search-results" style="max-width: 600px; margin: 20px auto;"></div>
                </div>
                <iframe id="drew-video" style="width: 100%; height: 100%; border: none; display: none;" src=""></iframe>
            </div>
        `;
        const window = windowManager.createWindow('Web Browser', content, 800, 600);
        this.attachBrowserEvents(window);
    }

    attachBrowserEvents(window) {
        const googlePage = window.querySelector('#google-page');
        const drewVideo = window.querySelector('#drew-video');
        const searchInput = window.querySelector('#google-search');
        const searchResults = window.querySelector('#search-results');
        
        window.querySelector('#google-btn').addEventListener('click', () => {
            googlePage.style.display = 'block';
            drewVideo.style.display = 'none';
        });
        
        window.querySelector('#drew-video-btn').addEventListener('click', () => {
            googlePage.style.display = 'none';
            drewVideo.style.display = 'block';
            drewVideo.src = 'https://www.youtube.com/embed/yJhZ8IAmUjs';
        });

        // Handle search functionality
        let searchTimeout;
        searchInput.addEventListener('keyup', (e) => {
            clearTimeout(searchTimeout);
            if (e.key === 'Enter' || e.target.value.length > 2) {
                searchTimeout = setTimeout(() => this.performSearch(e.target.value, searchResults), 500);
            }
        });
    }

    async performSearch(query, resultsContainer) {
        resultsContainer.innerHTML = '<div style="text-align: center;">Searching...</div>';
        
        try {
            const response = await fetch('/api/ai_completion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: `Generate 5 fake Google search results for the query: "${query}"
                    
                    <typescript-interface>
                    interface SearchResult {
                        title: string;
                        url: string;
                        description: string;
                    }
                    
                    interface Response {
                        results: SearchResult[];
                    }
                    </typescript-interface>
                    
                    <example>
                    {
                        "results": [
                            {
                                "title": "What is Python Programming? A Comprehensive Guide",
                                "url": "https://pythonguide.org/introduction",
                                "description": "Learn about Python programming language, its features, and why it's popular among developers. Includes tutorials and examples for beginners."
                            }
                        ]
                    }
                    </example>`,
                    data: query
                }),
            });

            const data = await response.json();
            
            resultsContainer.innerHTML = data.results.map(result => `
                <div style="margin-bottom: 20px;">
                    <div style="color: #202124; font-size: 14px;">${result.url}</div>
                    <div style="color: #1a0dab; font-size: 18px; margin: 4px 0; cursor: pointer;">${result.title}</div>
                    <div style="color: #4d5156; font-size: 14px;">${result.description}</div>
                </div>
            `).join('');

        } catch (error) {
            resultsContainer.innerHTML = '<div style="color: red;">An error occurred while searching. Please try again.</div>';
        }
    }
}

// Media Player App
class MediaPlayer {
    createMediaPlayer() {
        const content = `
            <div style="padding: 20px; text-align: center;">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 18px; margin-bottom: 10px;">Now Playing</div>
                    <div style="color: #666;">No media selected</div>
                </div>
                <div style="display: flex; justify-content: center; gap: 10px;">
                    <button style="padding: 10px 20px;">â®</button>
                    <button style="padding: 10px 20px;">âµ</button>
                    <button style="padding: 10px 20px;">â¸</button>
                    <button style="padding: 10px 20px;">â­</button>
                </div>
            </div>
        `;
        windowManager.createWindow('Media Player', content, 300, 200);
    }
}

// Calendar App
class Calendar {
    createCalendar() {
        const today = new Date();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"];

        // Create array for calendar cells
        let calendarCells = [];
        // Add empty cells for days before the 1st
        for (let i = 0; i < firstDay; i++) {
            calendarCells.push('');
        }
        // Add days of the month
        for (let i = 1; i <= daysInMonth; i++) {
            calendarCells.push(i);
        }

        const content = `
            <div style="padding: 20px;">
                <div style="text-align: center; font-size: 20px; margin-bottom: 10px;">
                    ${monthNames[currentMonth]} ${currentYear}
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center;">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                    ${calendarCells.map(day => {
                        const isToday = day === today.getDate();
                        return `<div style="padding: 5px; border: 1px solid #ddd; ${
                            isToday ? 'background: #32a5f2; color: white; border-radius: 50%;' : ''
                        }">${day}</div>`;
                    }).join('')}
                </div>
            </div>
        `;
        
        windowManager.createWindow('Calendar', content, 400, 400);
    }
}

// Email App
class Email {
    createEmail() {
        const content = `
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <input type="text" placeholder="Search emails..." style="width: 100%; padding: 5px;">
                </div>
                <div style="border-bottom: 1px solid #ddd; padding: 10px;">
                    <div style="font-weight: bold;">Welcome to YoshiOS</div>
                    <div style="color: #666;">System Admin - Welcome to your new operating system...</div>
                </div>
            </div>
        `;
        windowManager.createWindow('Email', content, 400, 500);
    }
}

// Weather App
class Weather {
    createWeather() {
        const content = `
            <div style="padding: 20px; text-align: center;">
                <div style="font-size: 24px; margin-bottom: 10px;">ð¤</div>
                <div style="font-size: 32px; margin-bottom: 10px;">72Â°F</div>
                <div>Partly Cloudy</div>
                <div style="color: #666;">High: 75Â°F  Low: 65Â°F</div>
            </div>
        `;
        windowManager.createWindow('Weather', content, 300, 200);
    }
}

// Slides App
class Slides {
    constructor() {
        this.currentSlide = 0;
        this.slides = [
            {
                title: "My Presentation",
                content: "Click to add content"
            }
        ];
    }

    createSlides() {
        const content = `
            <div style="height: 100%; display: flex; flex-direction: column;">
                <div class="slides-toolbar" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd; display: flex; gap: 10px;">
                    <button id="new-slide">New Slide</button>
                    <button id="delete-slide">Delete Slide</button>
                    <select id="theme-select">
                        <option value="default">Default Theme</option>
                        <option value="dark">Dark Theme</option>
                        <option value="gradient">Gradient Theme</option>
                    </select>
                    <button id="present">Present</button>
                </div>
                <div style="display: flex; height: calc(100% - 50px);">
                    <div class="slides-sidebar" style="width: 200px; background: #f5f5f5; padding: 10px; overflow-y: auto; border-right: 1px solid #ddd;">
                        <div id="slide-thumbnails"></div>
                    </div>
                    <div class="slides-main" style="flex-grow: 1; display: flex; flex-direction: column; padding: 20px; background: #e9e9e9;">
                        <div id="current-slide" style="background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); aspect-ratio: 16/9; display: flex; flex-direction: column; padding: 40px; margin: auto;">
                            <div contenteditable="true" class="slide-title" style="font-size: 32px; margin-bottom: 20px; outline: none;">Click to add title</div>
                            <div contenteditable="true" class="slide-content" style="font-size: 18px; outline: none;">Click to add content</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 5px; text-align: center; font-size: 11px; color: #666; border-top: 1px solid #eee;">
                    SlideIt Â© 2024 YoshiTech Corporation
                </div>
            </div>
        `;
        
        const window = windowManager.createWindow('SlideIt', content, 800, 600);
        this.attachEventListeners(window);
        this.updateThumbnails(window);
    }

    attachEventListeners(window) {
        const newSlideBtn = window.querySelector('#new-slide');
        const deleteSlideBtn = window.querySelector('#delete-slide');
        const themeSelect = window.querySelector('#theme-select');
        const presentBtn = window.querySelector('#present');
        const currentSlideEl = window.querySelector('#current-slide');

        newSlideBtn.addEventListener('click', () => {
            this.slides.push({
                title: "New Slide",
                content: "Click to add content"
            });
            this.currentSlide = this.slides.length - 1;
            this.updateThumbnails(window);
            this.showCurrentSlide(window);
        });

        deleteSlideBtn.addEventListener('click', () => {
            if (this.slides.length > 1) {
                this.slides.splice(this.currentSlide, 1);
                this.currentSlide = Math.max(0, this.currentSlide - 1);
                this.updateThumbnails(window);
                this.showCurrentSlide(window);
            }
        });

        themeSelect.addEventListener('change', (e) => {
            const theme = e.target.value;
            switch(theme) {
                case 'dark':
                    currentSlideEl.style.background = '#222';
                    currentSlideEl.style.color = '#fff';
                    break;
                case 'gradient':
                    currentSlideEl.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)';
                    currentSlideEl.style.color = '#333';
                    break;
                default:
                    currentSlideEl.style.background = '#fff';
                    currentSlideEl.style.color = '#333';
            }
        });

        presentBtn.addEventListener('click', () => {
            this.startPresentation(window);
        });

        // Save changes to slides array when editing
        const titleEl = window.querySelector('.slide-title');
        const contentEl = window.querySelector('.slide-content');

        titleEl.addEventListener('input', () => {
            this.slides[this.currentSlide].title = titleEl.innerText;
            this.updateThumbnails(window);
        });

        contentEl.addEventListener('input', () => {
            this.slides[this.currentSlide].content = contentEl.innerText;
            this.updateThumbnails(window);
        });
    }

    updateThumbnails(window) {
        const thumbnailsEl = window.querySelector('#slide-thumbnails');
        thumbnailsEl.innerHTML = '';

        this.slides.forEach((slide, index) => {
            const thumbnail = document.createElement('div');
            thumbnail.style.cssText = `
                padding: 10px;
                margin-bottom: 10px;
                background: white;
                border: 2px solid ${index === this.currentSlide ? '#ffd54f' : '#ddd'};
                cursor: pointer;
                font-size: 12px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            `;
            thumbnail.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${slide.title}</div>
                <div style="color: #666;">${slide.content.substring(0, 30)}...</div>
            `;
            thumbnail.addEventListener('click', () => {
                this.currentSlide = index;
                this.showCurrentSlide(window);
                this.updateThumbnails(window);
            });
            thumbnailsEl.appendChild(thumbnail);
        });
    }

    showCurrentSlide(window) {
        const titleEl = window.querySelector('.slide-title');
        const contentEl = window.querySelector('.slide-content');
        
        titleEl.innerText = this.slides[this.currentSlide].title;
        contentEl.innerText = this.slides[this.currentSlide].content;
    }

    startPresentation(window) {
        const presentationWindow = windowManager.createWindow('Presentation', '', window.offsetWidth, window.offsetHeight);
        presentationWindow.style.background = 'black';
        
        const presentationContent = document.createElement('div');
        presentationContent.style.cssText = `
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        `;
        
        let currentIndex = 0;
        
        const updateSlide = () => {
            const slide = this.slides[currentIndex];
            presentationContent.innerHTML = `
                <div style="text-align: center;">
                    <h1 style="font-size: 48px; margin-bottom: 30px;">${slide.title}</h1>
                    <div style="font-size: 24px;">${slide.content}</div>
                </div>
            `;
        };
        
        updateSlide();
        
        presentationContent.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % this.slides.length;
            updateSlide();
        });
        
        presentationWindow.querySelector('.window-content').appendChild(presentationContent);
    }
}

// DocIt App
class DocIt {
    constructor() {
        this.currentDoc = {
            content: '',
            fileName: 'Untitled Document'
        };
        this.savedDocs = [];
    }

    createDocIt() {
        const content = `
            <div style="height: 100%; display: flex; flex-direction: column;">
                <div class="doc-toolbar" style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #ddd;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="doc-name" value="${this.currentDoc.fileName}" 
                            style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        <button id="save-doc">Save</button>
                        <button id="new-doc">New</button>
                        <select id="doc-list">
                            <option value="">Open Document...</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <select id="font-family" style="padding: 5px;">
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                        <select id="font-size" style="padding: 5px;">
                            ${[8,10,12,14,16,18,20,24,28,32,36,48,72]
                                .map(size => `<option value="${size}">${size}</option>`).join('')}
                        </select>
                        <input type="color" id="font-color" value="#000000">
                        <button id="bold-btn" style="padding: 5px 10px;"><b>B</b></button>
                        <button id="italic-btn" style="padding: 5px 10px;"><i>I</i></button>
                        <button id="underline-btn" style="padding: 5px 10px;"><u>U</u></button>
                        <select id="align" style="padding: 5px;">
                            <option value="left">Left</option>
                            <option value="center">Center</option>
                            <option value="right">Right</option>
                            <option value="justify">Justify</option>
                        </select>
                    </div>
                </div>
                <div contenteditable="true" id="doc-content" style="flex-grow: 1; padding: 20px; overflow-y: auto; background: white;">
                </div>
                <div style="padding: 5px; text-align: center; font-size: 11px; color: #666; border-top: 1px solid #eee;">
                    DocIt Â© 2024 YoshiTech Corporation
                </div>
            </div>
        `;
        
        const window = windowManager.createWindow('DocIt', content, 800, 600);
        this.attachEventListeners(window);
        this.loadSavedDocs(window);
    }

    attachEventListeners(window) {
        const docContent = window.querySelector('#doc-content');
        const docName = window.querySelector('#doc-name');
        const saveBtn = window.querySelector('#save-doc');
        const newBtn = window.querySelector('#new-doc');
        const docList = window.querySelector('#doc-list');
        const fontFamily = window.querySelector('#font-family');
        const fontSize = window.querySelector('#font-size');
        const fontColor = window.querySelector('#font-color');
        const boldBtn = window.querySelector('#bold-btn');
        const italicBtn = window.querySelector('#italic-btn');
        const underlineBtn = window.querySelector('#underline-btn');
        const align = window.querySelector('#align');

        // Text formatting
        fontFamily.addEventListener('change', () => {
            document.execCommand('fontName', false, fontFamily.value);
        });

        fontSize.addEventListener('change', () => {
            document.execCommand('fontSize', false, fontSize.selectedIndex + 1);
        });

        fontColor.addEventListener('input', () => {
            document.execCommand('foreColor', false, fontColor.value);
        });

        boldBtn.addEventListener('click', () => {
            document.execCommand('bold', false, null);
        });

        italicBtn.addEventListener('click', () => {
            document.execCommand('italic', false, null);
        });

        underlineBtn.addEventListener('click', () => {
            document.execCommand('underline', false, null);
        });

        align.addEventListener('change', () => {
            document.execCommand(`justify${align.value}`, false, null);
        });

        // Document management
        saveBtn.addEventListener('click', () => {
            const doc = {
                fileName: docName.value,
                content: docContent.innerHTML
            };
            
            const existingIndex = this.savedDocs.findIndex(d => d.fileName === doc.fileName);
            if (existingIndex >= 0) {
                this.savedDocs[existingIndex] = doc;
            } else {
                this.savedDocs.push(doc);
            }
            
            localStorage.setItem('docit-docs', JSON.stringify(this.savedDocs));
            this.loadSavedDocs(window);
            alert('Document saved!');
        });

        newBtn.addEventListener('click', () => {
            if (confirm('Create new document? Any unsaved changes will be lost.')) {
                docName.value = 'Untitled Document';
                docContent.innerHTML = '';
            }
        });

        docList.addEventListener('change', () => {
            if (docList.value) {
                const doc = this.savedDocs.find(d => d.fileName === docList.value);
                if (doc) {
                    docName.value = doc.fileName;
                    docContent.innerHTML = doc.content;
                }
            }
        });
    }

    loadSavedDocs(window) {
        const saved = localStorage.getItem('docit-docs');
        if (saved) {
            this.savedDocs = JSON.parse(saved);
        }
        
        const docList = window.querySelector('#doc-list');
        docList.innerHTML = '<option value="">Open Document...</option>';
        this.savedDocs.forEach(doc => {
            const option = document.createElement('option');
            option.value = doc.fileName;
            option.textContent = doc.fileName;
            docList.appendChild(option);
        });
    }
}

// School App
class School {
    createSchool() {
        const subjects = [
            {
                name: 'Math',
                topics: [
                    'Pre-Algebra',
                    'Basic Geometry',
                    'Integer Operations',
                    'Fractions & Decimals',
                    'Basic Statistics'
                ]
            },
            {
                name: 'Science',
                topics: [
                    'Life Science',
                    'Physical Science',
                    'Earth Science',
                    'Scientific Method',
                    'Basic Chemistry'
                ]
            },
            {
                name: 'English',
                topics: [
                    'Reading Comprehension',
                    'Writing Essays',
                    'Grammar Rules',
                    'Vocabulary Building',
                    'Literature Analysis'
                ]
            },
            {
                name: 'History',
                topics: [
                    'World History',
                    'Geography',
                    'Ancient Civilizations',
                    'American History',
                    'Government & Civics'
                ]
            }
        ];

        const content = `
            <div style="padding: 20px;">
                <h2 style="margin-bottom: 20px; color: #5e35b1;">7th Grade Learning Center</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    ${subjects.map(subject => `
                        <div class="subject-card" style="
                            background: white;
                            border-radius: 8px;
                            padding: 15px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        ">
                            <h3 style="color: #5e35b1; margin-bottom: 10px;">${subject.name}</h3>
                            <ul style="list-style: none; padding: 0;">
                                ${subject.topics.map(topic => `
                                    <li style="
                                        margin: 8px 0;
                                        padding: 8px;
                                        background: #f5f5f5;
                                        border-radius: 4px;
                                        cursor: pointer;
                                        transition: background 0.2s;
                                    " onmouseover="this.style.background='#e0e0e0'"
                                       onmouseout="this.style.background='#f5f5f5'"
                                       onclick="school.openLesson('${subject.name}', '${topic}')"
                                    >
                                        ${topic}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        
        windowManager.createWindow('Learning Center', content, 800, 600);
    }

    openLesson(subject, topic) {
        const lessonContent = `
            <div style="padding: 20px;">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #5e35b1;">${subject}: ${topic}</h3>
                </div>
                <div id="lesson-content" style="margin-bottom: 20px;">
                    Loading lesson content...
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="school.startQuiz('${subject}', '${topic}')" style="padding: 10px 20px; background: #5e35b1; color: white; border: none; border-radius: 4px; cursor: pointer;">Start Quiz</button>
                    <button onclick="school.showNotes('${subject}', '${topic}')" style="padding: 10px 20px; background: #7e57c2; color: white; border: none; border-radius: 4px; cursor: pointer;">Study Notes</button>
                </div>
            </div>
        `;
        
        const lessonWindow = windowManager.createWindow(`${subject} - ${topic}`, lessonContent, 600, 400);
        this.loadLessonContent(subject, topic, lessonWindow);
    }

    async loadLessonContent(subject, topic, window) {
        try {
            const response = await fetch('/api/ai_completion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: `Generate a detailed but concise lesson about ${topic} suitable for 7th grade ${subject} class.

                    <typescript-interface>
                    interface Response {
                        content: string;
                        keyPoints: string[];
                    }
                    </typescript-interface>
                    
                    <example>
                    {
                        "content": "Pre-Algebra is the foundation of algebraic thinking...",
                        "keyPoints": [
                            "Understanding variables",
                            "Basic equations",
                            "Order of operations"
                        ]
                    }
                    </example>`,
                    data: `${subject} - ${topic}`
                })
            });

            const data = await response.json();
            
            const lessonContentEl = window.querySelector('#lesson-content');
            lessonContentEl.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    ${data.content}
                </div>
                <div style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px; color: #5e35b1;">Key Points:</h4>
                    <ul>
                        ${data.keyPoints.map(point => `<li>${point}</li>`).join('')}
                    </ul>
                </div>
            `;
        } catch (error) {
            console.error('Error loading lesson:', error);
        }
    }

    async startQuiz(subject, topic) {
        try {
            const response = await fetch('/api/ai_completion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: `Generate 5 multiple choice questions about ${topic} for 7th grade ${subject}.
                    
                    <typescript-interface>
                    interface Question {
                        question: string;
                        options: string[];
                        correctAnswer: number;
                    }
                    
                    interface Response {
                        questions: Question[];
                    }
                    </typescript-interface>
                    
                    <example>
                    {
                        "questions": [
                            {
                                "question": "What is a variable?",
                                "options": [
                                    "A number that varies",
                                    "A letter that represents a number",
                                    "A mathematical operation",
                                    "A type of equation"
                                ],
                                "correctAnswer": 1
                            }
                        ]
                    }
                    </example>`,
                    data: `${subject} - ${topic}`
                })
            });

            const data = await response.json();
            
            const quizContent = `
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 20px; color: #5e35b1;">${subject} - ${topic} Quiz</h3>
                    <form id="quiz-form">
                        ${data.questions.map((q, i) => `
                            <div style="margin-bottom: 20px;">
                                <p style="margin-bottom: 10px;"><strong>Question ${i + 1}:</strong> ${q.question}</p>
                                ${q.options.map((opt, j) => `
                                    <div style="margin: 5px 0;">
                                        <input type="radio" name="q${i}" value="${j}" id="q${i}o${j}">
                                        <label for="q${i}o${j}">${opt}</label>
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                        <button type="submit" style="padding: 10px 20px; background: #5e35b1; color: white; border: none; border-radius: 4px;">Submit Quiz</button>
                    </form>
                </div>
            `;
            
            const quizWindow = windowManager.createWindow('Quiz', quizContent, 500, 600);
            
            // Add quiz submission handler
            const form = quizWindow.querySelector('#quiz-form');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                let score = 0;
                data.questions.forEach((q, i) => {
                    const selected = form.querySelector(`input[name="q${i}"]:checked`);
                    if (selected && parseInt(selected.value) === q.correctAnswer) {
                        score++;
                    }
                });
                alert(`Your score: ${score}/${data.questions.length}`);
            });
        } catch (error) {
            console.error('Error starting quiz:', error);
        }
    }

    async showNotes(subject, topic) {
        try {
            const response = await fetch('/api/ai_completion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt: `Generate study notes for ${topic} in 7th grade ${subject}.
                    
                    <typescript-interface>
                    interface Response {
                        notes: string[];
                        examples: string[];
                        practice: string[];
                    }
                    </typescript-interface>
                    
                    <example>
                    {
                        "notes": [
                            "Variables represent unknown values",
                            "Algebraic expressions combine numbers and variables"
                        ],
                        "examples": [
                            "x + 5 = 12",
                            "2y - 3 = 7"
                        ],
                        "practice": [
                            "Solve for x: 3x + 2 = 14",
                            "Find y: 5y = 25"
                        ]
                    }
                    </example>`,
                    data: `${subject} - ${topic}`
                })
            });

            const data = await response.json();
            
            const notesContent = `
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 20px; color: #5e35b1;">${subject} - ${topic} Study Notes</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #7e57c2;">Key Concepts</h4>
                        <ul style="list-style-type: disc; margin-left: 20px;">
                            ${data.notes.map(note => `<li>${note}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #7e57c2;">Examples</h4>
                        <ul style="list-style-type: disc; margin-left: 20px;">
                            ${data.examples.map(example => `<li>${example}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #7e57c2;">Practice Problems</h4>
                        <ul style="list-style-type: disc; margin-left: 20px;">
                            ${data.practice.map(problem => `<li>${problem}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            windowManager.createWindow('Study Notes', notesContent, 500, 600);
        } catch (error) {
            console.error('Error showing notes:', error);
        }
    }
}

// Initialize
const windowManager = new WindowManager();
const calculator = new Calculator();
const notepad = new Notepad();
const paint = new Paint();
const fileExplorer = new FileExplorer();
const webBrowser = new WebBrowser();
const mediaPlayer = new MediaPlayer();
const calendar = new Calendar();
const email = new Email();
const weather = new Weather();
const slides = new Slides(); // Initialize Slides
const docit = new DocIt(); // Initialize DocIt
const school = new School(); // Initialize School

// Clock Functionality
function updateClock() {
    const clockElement = document.getElementById('clock');
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    clockElement.textContent = `${hours}:${minutes}`;
}

// Update clock every minute
setInterval(updateClock, 60000);
// Initial clock update
updateClock();

// Desktop Icons
const desktopIcons = [
    { 
        name: 'Calculator', 
        app: 'calculator',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="calcGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#6ab3ff;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2d8aff;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="gloss" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.5" />
                    <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#calcGrad)"/>
            <rect x="4" y="4" width="16" height="4" fill="#fff"/>
            <rect x="2" y="2" width="20" height="10" rx="3" fill="url(#gloss)" opacity="0.5"/>
            <rect x="4" y="10" width="8" height="3" rx="1" fill="#fff"/>
            <rect x="10" y="10" width="4" height="3" rx="1" fill="#fff"/>
            <rect x="4" y="15" width="8" height="3" rx="1" fill="#fff"/>
        </svg>`
    },
    { 
        name: 'Notepad', 
        app: 'notepad',
        svg: `<svg viewBox="0 0 24 24" width="24" height="24">
            <defs>
                <linearGradient id="notepadGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffcf87;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ffa726;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#notepadGrad)"/>
            <rect x="2" y="2" width="20" height="10" rx="3" fill="url(#gloss)" opacity="0.5"/>
            <rect x="5" y="6" width="14" height="2" fill="#fff" opacity="0.8"/>
            <rect x="5" y="10" width="14" height="2" fill="#fff" opacity="0.8"/>
            <rect x="5" y="14" width="14" height="2" fill="#fff" opacity="0.8"/>
        </svg>`
    },
    { 
        name: 'Paint', 
        app: 'paint',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="paintGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ff87b3;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ff4081;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#paintGradStart)"/>
            <path d="M6,12 C10,8 14,16 18,12" stroke="#fff" stroke-width="2" fill="none"/>
            <circle cx="12" cy="12" r="2" fill="#fff"/>
        </svg>`
    },
    { 
        name: 'File Explorer', 
        app: 'explorer',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="folderGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#90caf9;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#42a5f5;stop-opacity:1" />
                </linearGradient>
            </defs>
            <path d="M2,6 L22,6 L22,20 L2,20 Z" fill="url(#folderGrad)"/>
            <path d="M2,6 L10,6 L12,4 L22,4 L22,6" fill="url(#folderGrad)"/>
            <rect x="2" y="6" width="20" height="7" fill="url(#gloss)" opacity="0.3"/>
        </svg>`
    },
    { 
        name: 'Web Browser', 
        app: 'browser',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="browserGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#87ffce;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#40c4ff;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#browserGradStart)"/>
            <circle cx="12" cy="12" r="5" fill="none" stroke="#fff" stroke-width="2"/>
            <path d="M12,7 L12,17 M7,12 L17,12" stroke="#fff" stroke-width="2"/>
        </svg>`
    },
    { 
        name: 'Media Player', 
        app: 'mediaplayer',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="mediaGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ff8a65;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ff5722;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#mediaGrad)"/>
            <path d="M10,8 L16,12 L10,16 Z" fill="#fff"/>
        </svg>`
    },
    { 
        name: 'Calendar', 
        app: 'calendar',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="calendarGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#81c784;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#4caf50;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="4" width="20" height="16" rx="3" fill="url(#calendarGrad)"/>
            <rect x="2" y="6" width="20" height="3" fill="#ff5252"/>
            <text x="12" y="16" text-anchor="middle" fill="#333" style="font-size: 6px;">15</text>
        </svg>`
    },
    { 
        name: 'Email', 
        app: 'email',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="emailGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#64b5f6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2196f3;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="4" width="20" height="16" rx="3" fill="url(#emailGrad)"/>
            <path d="M2,6 L12,12 L22,6" stroke="#fff" fill="none" stroke-width="2"/>
        </svg>`
    },
    { 
        name: 'Weather', 
        app: 'weather',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="weatherGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#4fc3f7;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#03a9f4;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#weatherGrad)"/>
            <circle cx="12" cy="12" r="4" fill="#fff"/>
            <path d="M12,4 L12,6 M20,12 L18,12 M12,20 L12,18 M4,12 L6,12" stroke="#fff" stroke-width="2"/>
        </svg>`
    },
    { 
        name: 'Learning Center', 
        app: 'school',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="schoolGradIcon" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#9575cd;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#5e35b1;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#schoolGradIcon)"/>
            <path d="M12,4 L4,8 L12,12 L20,8 L12,4" fill="#fff"/>
            <path d="M7,10 L7,15 L12,18 L17,15 L17,10" fill="#fff" opacity="0.6"/>
        </svg>`
    },
    { 
        name: 'SlideIt', 
        app: 'slides',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="slidesGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffd54f;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ffb300;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#slidesGradStart)"/>
            <rect x="6" y="6" width="12" height="8" fill="#fff" opacity="0.9"/>
            <rect x="8" y="10" width="8" height="1" fill="#ffb300"/>
            <rect x="8" y="12" width="6" height="1" fill="#ffb300"/>
        </svg>`
    },
    { 
        name: 'DocIt', 
        app: 'docit',
        svg: `<svg viewBox="0 0 24 24">
            <defs>
                <linearGradient id="docGradStart" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#81d4fa;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#29b6f6;stop-opacity:1" />
                </linearGradient>
            </defs>
            <rect x="2" y="2" width="20" height="20" rx="3" fill="url(#docGradStart)"/>
            <rect x="6" y="6" width="12" height="2" fill="#fff" opacity="0.9"/>
            <rect x="6" y="10" width="12" height="1" fill="#fff" opacity="0.7"/>
            <rect x="6" y="13" width="12" height="1" fill="#fff" opacity="0.7"/>
            <rect x="6" y="16" width="8" height="1" fill="#fff" opacity="0.7"/>
        </svg>`
    }
];

// Update the desktop icons creation code:
desktopIcons.forEach((icon, index) => {
    const iconElement = document.createElement('div');
    iconElement.className = 'icon';
    iconElement.innerHTML = `
        ${icon.svg}
        <span>${icon.name}</span>
    `;
    iconElement.style.position = 'absolute';
    
    // Calculate grid position
    const column = Math.floor(index / 5); // Integer division for column number
    const row = index % 5; // Remainder for row number
    
    iconElement.style.top = `${row * 110 + 20}px`; // 110px vertical spacing
    iconElement.style.left = `${column * 100 + 20}px`; // 100px horizontal spacing

    // Rest of the event listener code remains the same...
    iconElement.addEventListener('click', () => {
        switch(icon.app) {
            case 'calculator':
                calculator.createCalculator();
                break;
            case 'notepad':
                notepad.createNotepad();
                break;
            case 'paint':
                paint.createPaint();
                break;
            case 'explorer':
                fileExplorer.createExplorer();
                break;
            case 'browser':
                webBrowser.createBrowser();
                break;
            case 'mediaplayer':
                mediaPlayer.createMediaPlayer();
                break;
            case 'calendar':
                calendar.createCalendar();
                break;
            case 'email':
                email.createEmail();
                break;
            case 'weather':
                weather.createWeather();
                break;
            case 'school':
                school.createSchool();
                break;
            case 'slides':
                slides.createSlides();
                break;
            case 'docit':
                docit.createDocIt();
                break;
        }
    });

    document.getElementById('desktop').appendChild(iconElement);
});

// Shutdown
document.getElementById('shutdown').addEventListener('click', () => {
    document.getElementById('start-menu').style.display = 'none';
    const shouldShutdown = confirm('Are you sure you want to shutdown?');
    if (shouldShutdown) {
        document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#000;color:#fff;">System Shutdown</div>';
    }
});
</script>
</body></html>
